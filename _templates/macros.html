{# Macros to make the life easier across the website #}


{%- macro figure(src, caption, style="", class="") -%}
  <figure class="{{ class }}">
    <img src="{{ src }}" alt="{{ caption|striptags }}" style="{{ style }}">
    <figcaption>{{ caption }}</figcaption>
  </figure>
{%- endmacro -%}


{%- macro button_link(href, text, type="btn-primary", icon="none", size="btn-sm", icon_position="start", external="true") -%}
  {%- set extra = "" -%}
  {%- if external == "true" -%}
    {%- set extra = extra ~ ' target="_blank"' -%}
  {%- endif -%}
  <a class="btn {{ size }} {{ type }} me-1 mb-2" href="{{ href }}"{{ extra }}>
    {%- if icon_position == "start" -%}
      <i class="{{ icon }} me-1" aria-hidden="true"></i>
    {%- endif -%}
    {{ text }}
    {%- if icon_position == "end" -%}
      <i class="{{ icon }} ms-1" aria-hidden="true"></i>
    {%- endif -%}
  </a>
{%- endmacro -%}


{%- macro nav_link(item, page, site) -%}
  {% set aria = "" %}
  {% set class = "nav-link" %}
  {% if page.id == item.id or page.parent == id|replace('/index', '') %}
    {% set class = class + " active" %}
    {% set aria = 'aria-current="page"' %}
  {% endif %}
  <a class="{{ class }}" {{ aria }} href="{{ site[item.id].path|relative_to(page.path) }}">{{ item.name }}</a>
{%- endmacro -%}


{%- macro social_icon(title, icon, url) -%}
  {# The rel="me" attribute verifies for these profiles that I own this domain #}
  <a rel="me" aria-label="{{ title }}" href="{{ url }}" target="_blank">
    <i class="{{ icon }} fa-lg me-2" title="{{ title }}" aria-hidden="true"></i>
  </a>
{%- endmacro -%}


{%- macro youtube_link(id) -%}
  {%- if id[:5] == "list:" %}
    {%- set link = "https://www.youtube.com/playlist?list=" ~ id[5:] %}
  {%- else %}
    {%- set link = "https://www.youtube.com/watch?v=" ~ id %}
  {%- endif %}
  {{ link }}
{%- endmacro -%}


{%- macro publication_list(publications, author_names) -%}
{%- for paper in publications %}
  {%- if paper.doi is defined %}
    {%- set doi = paper.doi %}
  {%- elif paper.preprint %}
    {%- set doi = paper.preprint %}
  {%- endif %}
  {%- if doi is defined %}
    {%- set anchor = doi|trim|lower|replace(".", "")|replace("/", "") %}
  {%- elif paper.github is defined %}
    {%- set anchor = paper.github|trim|lower|replace(".", "")|replace("/", "-") %}
  {%- else  %}
    {%- set anchor = paper.year ~ loop.index %}
  {%- endif %}
  {%- if paper.openaccess is defined and paper.openaccess %}
    {%- set pdf = "https://doi.org/" ~ paper.doi %}
  {%- elif paper.preprint is defined %}
    {%- set pdf = "https://doi.org/" ~ paper.preprint %}
  {%- elif paper.pdf is defined %}
    {%- set pdf = paper.pdf %}
  {%- endif %}
  {%- set id = anchor %}
  <div class="mb-2">
    <h3 class="fs-5 mb-1" id="{{ anchor }}">
      <a href="#{{ anchor }}">
        <span class="text-muted fs-6">{{ loop.length - loop.index0 }}. </span>
        {{ paper.title|trim }}
        <i class="anchor fas fa-link fa-xs" aria-hidden="true"></i>
      </a>
    </h3>
    <p class="mb-1 text-muted fs-6">
      {%- for author in paper.authors %}
        {%- if author == "Me" %}
          <strong>{{ author_names[author] }}</strong>
        {%- else %}
          {{ author_names[author] }}
        {%- endif %}
        {%- if not loop.last -%},{%- endif -%}
      {%- endfor %}
    </p>
    <p class="mb-2 text-muted fs-6">
      {{ paper.year }}
      {%- if paper.journal is defined -%}
        . {{ paper.journal }}
      {%- elif paper.conference is defined -%}
        . {{ paper.conference }}
      {%- endif -%}
      {%- if doi is defined -%}
        . doi:<a target="_blank" href="https://doi.org/{{ doi }}">{{ doi }}</a>
      {%- endif -%}
    </p>
    <button
        class="hidden-section-toggle btn btn-dark btn-sm me-1 mb-2 collapsed"
        type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ id }}"
        aria-expanded="false" aria-controls="collapse-{{ id }}">
      <i class="hidden-section-toggle-icon fa fa-chevron-circle-down me-1" aria-hidden="true"></i>
      More information
    </button>
    {%- if pdf is defined %}
      {{ button_link(pdf, "Free PDF", type="btn-dark", icon="fa fa-file-pdf") }}
    {%- endif %}
    {%- if paper.slides is defined %}
      {{ button_link(paper.slides, "Slides", type="btn-dark", icon="fa fa-desktop") }}
    {%- endif %}
    {%- if paper.poster is defined %}
      {{ button_link(paper.poster, "Poster", type="btn-dark", icon="fa fa-image") }}
    {%- endif %}
    {%- if paper.recording is defined %}
      {{ button_link("https://www.youtube.com/watch?v=" ~ paper.recording, "Recording", type="btn-dark", icon="fab fa-youtube") }}
    {%- endif %}
    {%- if paper.data is defined %}
      {{ button_link("https://doi.org/" ~ paper.data, "Open data", type="btn-dark", icon="fa fa-chart-bar") }}
    {%- endif %}
    {%- if paper.github is defined %}
      {{ button_link("https://github.com/" ~ paper.github, "Source code", type="btn-dark", icon="fab fa-github") }}
    {%- endif %}
    <div id="collapse-{{ id }}" class="collapse paper-info mt-2 overflow-hidden">
      {%- if paper.note is defined %}
        <div class="callout callout-note mb-4">
          <p>
            <i class="fas fa-info-circle" aria-hidden="true"></i>
            <strong>Note:</strong>
            {{ paper.note|trim }}
          </p>
        </div>
      {%- endif %}
      {%- if paper.poster_embed is defined %}
        <h4 class="fs-4">Poster</h4>
        <div class="mb-3">
        {{ paper.poster_embed|trim }}
        </div>
      {%- endif %}
      {%- if paper.about is defined %}
        <h4 class="fs-4">About</h4>
        <p>{{ paper.about|trim }}</p>
      {%- endif %}
      {%- if paper.abstract is defined %}
        <h4 class="fs-4">Abstract</h4>
        <p>{{ paper.abstract|trim }}</p>
      {%- endif %}
      {%- if doi is defined %}
        <h4 class="fs-4 mb-4">Citations</h4>
        <span class="__dimensions_badge_embed__" data-doi="{{ doi }}"></span>
      {%- endif %}
    </div>
  </div>
{%- endfor %}
{%- endmacro -%}


{%- macro publication_sections(sections, page, author_names) -%}
{%- for data, title in sections %}
  {%- if loop.first %}
    {% set toggle_class = "" %}
    {% set collapse_class = "show" %}
  {%- else %}
    {% set toggle_class = "collapsed" %}
    {% set collapse_class = "" %}
  {%- endif %}
  <h2 class="hidden-section-title">
    <a class="hidden-section-toggle {{ toggle_class }}" data-bs-toggle="collapse" href="#collapse-{{ data }}" aria-controls="collapse-{{ data }}" aria-expanded="false" role="button">
    <i class="hidden-section-toggle-icon fas fa-chevron-down text-muted me-1" aria-hidden="true"></i>
    {{ title }}
    </a>
  </h2>
  <div id="collapse-{{ data }}" class="hidden-section collapse {{ collapse_class }}">
  {{ publication_list(page[data], author_names) }}
  </div>
{%- endfor %}
{%- endmacro -%}
